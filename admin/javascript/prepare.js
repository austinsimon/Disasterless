var routes = [
	{
		name: "I4"
		, "point1": {
			"lat": 28.9593273565521
			, "lng": -81.25646211547848
		}
		, "point2": {
			"lat": 28.21327083622516
			, "lng": -81.67600252075192
		}
	}, {
		name: "SR-408"
		, "point1": {
			"lat": 28.54621692135344
			, "lng": -81.55060388488766
		}
		, "point2": {
			"lat": 28.54697088283036
			, "lng": -81.26766302032468
		}
	}, {
		name: "SR-528"
		, "point1": {
			"lat": 28.56853189609642
			, "lng": -81.26015283508298
		}
		, "point2": {
			"lat": 28.457890735892175
			, "lng": -80.98545171661374
		}
	}, {
		name: "SR-91"
		, "point1": {
			"lat": 28.54900655185778
			, "lng": -81.63883783264157
		}
		, "point2": {
			"lat": 28.26786424606056
			, "lng": -81.33358098907468
		}
	}, {
		name: "SR-436"
		, "point1": {
			"lat": 28.678793288574536
			, "lng": -81.52004815979001
		}
		, "point2": {
			"lat": 28.66203740731304
			, "lng": -81.39005758209225
		}
	}, {
		"point1": {
			"lat": 28.673258496084756
			, "lng": -81.49893381042477
		}
		, "point2": {
			"lat": 28.673258496084756
			, "lng": -81.49893381042477
		}
		, "waypoints": [
			{
				"location": {
					"lat": 28.550966788546155
					, "lng": -81.39662362976071
				}
    }




			
			, {
				"location": {
					"lat": 28.477055725541536
					, "lng": -81.39670946044919
				}
    }




			
			, {
				"location": {
					"lat": 28.381649125202962
					, "lng": -81.40460588378903
				}
    }
  ]
}, {
		"point1": {
			"lat": 28.399468911204767
			, "lng": -80.94592668457028
		}
		, "point2": {
			"lat": 28.399468911204767
			, "lng": -80.94592668457028
		}
		, "waypoints": [
			{
				"location": {
					"lat": 28.455023233834964
					, "lng": -80.98437883300778
				}
    }




			
			, {
				"location": {
					"lat": 28.542522432099936
					, "lng": -81.08737565917966
				}
    }, {
				"location": {
					"lat": 28.565441252773887
					, "lng": -81.16839982910153
				}
    }
  ]
}, {
		"point1": {
			"lat": 28.796159795398758
			, "lng": -81.34383775634763
		}
		, "point2": {
			"lat": 28.796159795398758
			, "lng": -81.34383775634763
		}
		, "waypoints": [
			{
				"location": {
					"lat": 28.729948026399665
					, "lng": -81.24667741699216
				}
    }, {
				"location": {
					"lat": 28.63650307201217
					, "lng": -81.24315835876462
				}
    }, {
				"location": {
					"lat": 28.460758160168005
					, "lng": -81.232601184082
				}
    }
  ]
}, {
		"point1": {
			"lat": 28.45140101480317
			, "lng": -81.21200181884763
		}
		, "point2": {
			"lat": 28.45140101480317
			, "lng": -81.21200181884763
		}
		, "waypoints": [
			{
				"location": {
					"lat": 28.450646370219257
					, "lng": -81.29439927978513
				}
    }, {
				"location": {
					"lat": 28.450872764159968
					, "lng": -81.34049035949704
				}
    }, {
				"location": {
					"lat": 28.421248774418487
					, "lng": -81.43228628082272
				}
    }
  ]
}
];

var shelters = [{
	name: "Barnett Park Community Center"
	, address: "4801 W. Colonial Dr. Orlando, FL 32808"
	, pets: true
	, location: {
		lat: 28.5587805
		, lng: -81.44161600000001
	}
			}, {
	name: "Odyssey Middle School"
	, address: "9290 Lee Vista Blvd. Orlando, FL 32829"
	, pets: false
	, location: {
		lat: 28.4747803
		, lng: -81.25695969999998
	}
			}, {
	name: "Apopka High School"
	, address: "425 N Park Ave Apopka, FL 32712"
	, pets: false
	, location: {
		lat: 28.6855714
		, lng: -81.5090472
	}
			}, {
	name: "Colonial High School"
	, address: "6100 Oleander Dr. Orlando, FL 32807"
	, pets: false
	, location: {
		lat: 28.5525316
		, lng: -81.30180489999998
	}
			}, {
	name: "Apopka Middle School"
	, address: "555 W. Martin St. Apopka, FL 32712"
	, pets: false
	, location: {
		lat: 28.6912367
		, lng: -81.52141069999999
	}
			}, {
	name: "Conway Middle School"
	, address: "4600 Anderson Rd. Orlando, FL 32812"
	, pets: false
	, location: {
		lat: 28.5006147
		, lng: -81.32790490000002
	}
			}, {
	name: "Union Park Middle School"
	, address: "1844 Westfall Dr. Orlando, FL 32817"
	, pets: false
	, location: {
		lat: 28.5711742
		, lng: -81.24857070000002
	}
			}, {
	name: "East River High School"
	, address: "650 East River Falcons Way Orlando, FL 32833"
	, pets: false
	, location: {
		lat: 28.5572611
		, lng: -81.13101069999999
	}
			}, {
	name: "Edgewater High School"
	, address: "3100 Edgewater Dr. Orlando, FL 32804"
	, pets: false
	, location: {
		lat: 28.5813967
		, lng: -81.39193920000002
	}
			}, {
	name: "Memorial Middle School"
	, address: "2220 29th St. Orlando, FL 32805"
	, pets: false
	, location: {
		lat: 28.5114678
		, lng: -81.40634139999997
	}
			}, {
	name: "West Orange High School"
	, address: "1625 Beulah Rd. Winter Garden, FL 34787"
	, pets: false
	, location: {
		lat: 28.542228
		, lng: -81.56701399999997
	}
			}, {
	name: "Bithlo Community Center"
	, address: "18501 Washington Ave. Orlando, FL 32820"
	, pets: true
	, location: {
		lat: 28.559478
		, lng: -81.102644
	}
			}, {
	name: "Meadow Woods Middle School"
	, address: "1800 Rhode Island Wood Circle Orlando, FL 32824"
	, pets: false
	, location: {
		lat: 28.3704401
		, lng: -81.34564209999996
	}
			}, {
	name: "Ocoee High School"
	, address: "1925 Ocoee Point Parkway Ocoee, FL 34761"
	, pets: false
	, location: {
		lat: 28.5998778
		, lng: -81.5576385
	}
			}, {
	name: "Gotha Middle School"
	, address: "9155 Gotha Road Windermere, FL 34786"
	, pets: false
	, location: {
		lat: 28.5299425
		, lng: -81.5112909
	}
			}, {
	name: "Hunter's Creek Middle School"
	, address: "13400 Town Loop Blvd. Orlando, FL 32837"
	, pets: false
	, location: {
		lat: 28.367851
		, lng: -81.43513999999999
	}
			}, {
	name: "Lakeview Middle School"
	, address: "1200 West Bay Street Winter Garden, FL 34787"
	, pets: false
	, location: {
		lat: 28.564501
		, lng: -81.60241300000001
	}
			}, {
	name: "Oakridge High School"
	, address: "6000 Winegard Road Orlando, FL 32809"
	, pets: true
	, location: {
		lat: 28.469936
		, lng: -81.38451900000001
	}
}];

var suppliesMap;
var supplies = [];

var apiKey = 'AIzaSyBvk_axFbqqgSxvDlBlL-tnjITbvllJ4QM';
var directionsService;

function initMap() {
	var map = new google.maps.Map(document.getElementById('sheltersMap'), {
		zoom: 10
		, center: {
			lat: 28.5383
			, lng: -81.3792
		}
	});

	for (var i = 0; i < shelters.length; i++) {
		var shelter = shelters[i];

		var marker = new google.maps.Marker({
			position: shelter.location
			, map: map
			, title: shelter.name
			, draggable: false
		});
	}

	initSuppliesMap();
	initOutagesMap();
}

function initOutagesMap() {
	map = new google.maps.Map(document.getElementById('routesMap'), {
		zoom: 10
		, center: {
			lat: 28.5383
			, lng: -81.3792
		}
	});

	directionsService = new google.maps.DirectionsService();

	for (var i = 0; i < routes.length; i++) {
		var request;
		if (typeof routes[i].waypoints != "undefined") {
			request = {
				origin: routes[i].point1
				, destination: routes[i].point2
				, travelMode: 'DRIVING'
				, waypoints: routes[i].waypoints
			};
		} else {
			request = {
				origin: routes[i].point1
				, destination: routes[i].point2
				, travelMode: 'DRIVING'
			};
		}
		makeRequest(request);
	}
}

function makeRequest(request, store) {
	directionsService.route(request, function (result, status) {
		if (status == 'OK') {
			if (store && polyline != null) {
				polyline.setMap(null);
			}

			var snappedPolyline = new google.maps.Polyline({
				path: result.routes[0].overview_path
				, strokeColor: 'black'
				, strokeWeight: 3
			});

			snappedPolyline.setMap(map);

			if (store) {
				polyline = snappedPolyline;
			}
		}
	});
}

function initSuppliesMap() {
	suppliesMap = new google.maps.Map(document.getElementById('suppliesMap'), {
		zoom: 10
		, center: {
			lat: 28.5383
			, lng: -81.3792
		}
	});

	$.ajax({
		url: "../includes/get_supplies.php"
		, type: "POST"
		, dataType: "json"
		, success: function (data) {
			for (var i = 0; i < data.length; i++) {
				var supply = data[i];
				supply.position.lat = parseFloat(supply.position.lat);
				supply.position.lng = parseFloat(supply.position.lng);
				createSupply(data[i]);
			}
		}
		, error: function (data) {
			console.log(data);
		}
	});
}

function getMarkerIcon(supplyAmount) {
	switch (supplyAmount) {
	case "high":
		return "../images/green_pin.png";
	case "low":
		return "../images/yellow_pin.png";
	case "none":
		return "../images/red_pin.png";
	}
}

function createSupply(supply) {
	var marker = new google.maps.Marker({
		position: {
			lat: supply.position.lat
			, lng: supply.position.lng
		}
		, map: suppliesMap
		, title: supply.name
		, animation: google.maps.Animation.DROP
		, draggable: false
		, icon: getMarkerIcon(supply.amount)
	});

	supply.marker = marker;
	supplies.push(supply);
}

$(document).ready(function () {
	$("#resetSupplies").click(function () {
		$.ajax({
			url: "../includes/reset_supplies.php"
			, type: "POST"
			, success: function (data) {
				console.log(data);

				for (var i = 0; i < supplies.length; i++) {
					supplies[i].marker.setMap(null);
				}

				supplies = [];
			}
			, error: function (data) {
				console.log(data);
			}
		});
	});
});